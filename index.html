<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡∏ù‡∏≤‡∏Å‡∏Ç‡∏¢‡∏∞</title>

  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <style>
    body{font-family:system-ui,Arial;background:#eef3f7;margin:0;padding:16px;font-size:18px}
    .card{background:#fff;border-radius:18px;padding:18px;max-width:520px;margin:0 auto;box-shadow:0 6px 18px rgba(0,0,0,.08)}
    .title{font-size:26px;font-weight:900;text-align:center;margin:6px 0 12px}
    .name{font-size:18px;text-align:center;color:#222;background:#f6f8fa;border-radius:12px;padding:8px;margin-bottom:12px}
    .step{font-size:18px;font-weight:700;margin-top:10px}
    input{width:100%;padding:12px;border-radius:12px;border:1px solid #ccc;margin-top:6px;font-size:16px}
    .btn{width:100%;background:#06c755;color:#fff;border:0;border-radius:14px;font-size:20px;font-weight:700;padding:14px;margin-top:16px}
    .preview{max-width:100%;border-radius:12px;margin-top:10px;display:none}
  </style>
</head>

<body>
<div class="card">
  <div class="title">üì¶ ‡∏ù‡∏≤‡∏Å‡∏Ç‡∏¢‡∏∞</div>

  <div id="who" class="name">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>

  <div class="step">üì∑ ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏Ç‡∏¢‡∏∞</div>
  <input type="file" id="photo" accept="image/*" capture="environment" />
  <img id="preview" class="preview" />

  <div class="step">‚öñÔ∏è ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (‡∏Å‡∏Å.)</div>
  <input type="number" id="weight" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1.50" step="0.01" />

  <button class="btn" onclick="submitData()">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
</div>

<script>
const LIFF_ID = "2009222279-hD8AGu5R";
const GAS_URL = "https://script.google.com/macros/s/AKfycby89i23f9-_GlbxwhzQUJ_Ale-nctOoM86afx22DbvS0743R25ZDN_xePFYOyRMqYbC/exec";

let userId="",displayName="";

document.getElementById("photo").onchange=e=>{
  const img=document.getElementById("preview");
  img.src=URL.createObjectURL(e.target.files[0]);
  img.style.display="block";
};

(async()=>{
  await liff.init({liffId:LIFF_ID});
  if(!liff.isLoggedIn()){liff.login();return;}
  const p=await liff.getProfile();
  userId=p.userId;
  displayName=p.displayName;
  document.getElementById("who").textContent="üë§ "+displayName;
})();

async function submitData(){
  const file=document.getElementById("photo").files[0];
  const weight=document.getElementById("weight").value;

  if(!file){alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ");return;}
  if(!weight){alert("‡πÉ‡∏™‡πà‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å");return;}

  const base64=await new Promise(res=>{
    const r=new FileReader();
    r.onload=()=>res(r.result);
    r.readAsDataURL(file);
  });

  const payload={
    displayName,
    userId,
    weightKg:Number(weight),
    imageData:base64
  };

  const body=new URLSearchParams();
  body.append("payload",JSON.stringify(payload));

  await fetch(GAS_URL,{method:"POST",body});
  alert("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß");
  if(liff.isInClient())liff.closeWindow();
}
</script>
</body>
</html>
